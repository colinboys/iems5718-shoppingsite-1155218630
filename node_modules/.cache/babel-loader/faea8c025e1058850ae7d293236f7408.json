{"remainingRequest":"D:\\IEMS5718web\\shop_demo\\node_modules\\babel-loader\\lib\\index.js!D:\\IEMS5718web\\shop_demo\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!D:\\IEMS5718web\\shop_demo\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!D:\\IEMS5718web\\shop_demo\\src\\views\\OrderAdmin.vue?vue&type=script&setup=true&lang=js","dependencies":[{"path":"D:\\IEMS5718web\\shop_demo\\src\\views\\OrderAdmin.vue","mtime":1745129617162},{"path":"D:\\IEMS5718web\\shop_demo\\babel.config.js","mtime":1738482584419},{"path":"D:\\IEMS5718web\\shop_demo\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746349774639},{"path":"D:\\IEMS5718web\\shop_demo\\node_modules\\babel-loader\\lib\\index.js","mtime":1746349776751},{"path":"D:\\IEMS5718web\\shop_demo\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746349774639},{"path":"D:\\IEMS5718web\\shop_demo\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1746349777201}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgcmVmLCBvbk1vdW50ZWQgfSBmcm9tICd2dWUnOwppbXBvcnQgcmVxdWVzdCBmcm9tICdAL3V0aWxzL3JlcXVlc3QnOwpleHBvcnQgZGVmYXVsdCB7CiAgX19uYW1lOiAnT3JkZXJBZG1pbicsCiAgc2V0dXAoX19wcm9wcywgewogICAgZXhwb3NlOiBfX2V4cG9zZQogIH0pIHsKICAgIF9fZXhwb3NlKCk7CiAgICBjb25zdCBvcmRlcnMgPSByZWYoW10pOwogICAgY29uc3Qgc2hvd01vZGFsID0gcmVmKGZhbHNlKTsKICAgIGNvbnN0IHNlbGVjdGVkT3JkZXJJdGVtcyA9IHJlZihbXSk7CiAgICBjb25zdCBmZXRjaE9yZGVycyA9IGFzeW5jICgpID0+IHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QuZ2V0KCcvYXBpL2FkbWluL29yZGVycycsIHsKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgJHtsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYXV0aF90b2tlbicpfWAKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBvcmRlcnMudmFsdWUgPSByZXNwb25zZS5kYXRhOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBmZXRjaCBvcmRlcnM6JywgZXJyb3IpOwogICAgICB9CiAgICB9OwogICAgY29uc3Qgc2hvd0l0ZW1zID0gb3JkZXIgPT4gewogICAgICB0cnkgewogICAgICAgIC8vIOajgOafpSBpdGVtcyDmmK/lkKblt7Lnu4/mmK/lr7nosaEKICAgICAgICBzZWxlY3RlZE9yZGVySXRlbXMudmFsdWUgPSB0eXBlb2Ygb3JkZXIuaXRlbXMgPT09ICdzdHJpbmcnID8gSlNPTi5wYXJzZShvcmRlci5pdGVtcykgOiBvcmRlci5pdGVtczsKICAgICAgICBzaG93TW9kYWwudmFsdWUgPSB0cnVlOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBwYXJzZSBvcmRlciBpdGVtczonLCBlcnJvcik7CiAgICAgICAgYWxlcnQoJ0Vycm9yIGRpc3BsYXlpbmcgb3JkZXIgaXRlbXMnKTsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IGZvcm1hdERhdGUgPSBkYXRlU3RyaW5nID0+IHsKICAgICAgcmV0dXJuIG5ldyBEYXRlKGRhdGVTdHJpbmcpLnRvTG9jYWxlU3RyaW5nKCk7CiAgICB9OwogICAgY29uc3QgdXBkYXRlT3JkZXJTdGF0dXMgPSBhc3luYyBvcmRlciA9PiB7CiAgICAgIHRyeSB7CiAgICAgICAgYXdhaXQgcmVxdWVzdC5wdXQoYC9hcGkvYWRtaW4vb3JkZXJzLyR7b3JkZXIub3JkZXJfaWR9YCwgewogICAgICAgICAgc3RhdHVzOiBvcmRlci5zdGF0dXMKICAgICAgICB9LCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYCR7bG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2F1dGhfdG9rZW4nKX1gCiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHVwZGF0ZSBvcmRlciBzdGF0dXM6JywgZXJyb3IpOwogICAgICB9CiAgICB9OwogICAgb25Nb3VudGVkKCgpID0+IHsKICAgICAgZmV0Y2hPcmRlcnMoKTsKICAgIH0pOwogICAgY29uc3QgX19yZXR1cm5lZF9fID0gewogICAgICBvcmRlcnMsCiAgICAgIHNob3dNb2RhbCwKICAgICAgc2VsZWN0ZWRPcmRlckl0ZW1zLAogICAgICBmZXRjaE9yZGVycywKICAgICAgc2hvd0l0ZW1zLAogICAgICBmb3JtYXREYXRlLAogICAgICB1cGRhdGVPcmRlclN0YXR1cywKICAgICAgcmVmLAogICAgICBvbk1vdW50ZWQsCiAgICAgIGdldCByZXF1ZXN0KCkgewogICAgICAgIHJldHVybiByZXF1ZXN0OwogICAgICB9CiAgICB9OwogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KF9fcmV0dXJuZWRfXywgJ19faXNTY3JpcHRTZXR1cCcsIHsKICAgICAgZW51bWVyYWJsZTogZmFsc2UsCiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICAgIHJldHVybiBfX3JldHVybmVkX187CiAgfQp9Ow=="},{"version":3,"names":["ref","onMounted","request","orders","showModal","selectedOrderItems","fetchOrders","response","get","headers","localStorage","getItem","value","data","error","console","showItems","order","items","JSON","parse","alert","formatDate","dateString","Date","toLocaleString","updateOrderStatus","put","order_id","status"],"sources":["D:/IEMS5718web/shop_demo/src/views/OrderAdmin.vue"],"sourcesContent":["<template>\r\n  <div class=\"order-admin\">\r\n    <!-- <h2>Order Management</h2> -->\r\n    \r\n    <div class=\"orders-list\">\r\n      <table>\r\n        <thead>\r\n          <tr>\r\n            <th>Order ID</th>\r\n            <th>User ID</th>\r\n            <th>Total Price</th>\r\n            <th>Items</th>\r\n            <th>Status</th>\r\n            <th>Payment Status</th>\r\n            <th>Created At</th>\r\n            <th>Paid At</th>\r\n            <!-- <th>Actions</th> -->\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          <tr v-for=\"order in orders\" :key=\"order.order_id\">\r\n            <td>{{ order.order_id }}</td>\r\n            <td>{{ order.user_id }}</td>\r\n            <td>${{ order.total_price }}</td>\r\n            <td>\r\n              <button @click=\"showItems(order)\" class=\"view-items-btn\">\r\n                View Items\r\n              </button>\r\n            </td>\r\n            <td>\r\n              <span :class=\"['status-badge', order.status]\">\r\n                {{ order.status }}\r\n              </span>\r\n            </td>\r\n            <td>\r\n              <span :class=\"['payment-badge', order.payment_status]\">\r\n                {{ order.payment_status }}\r\n              </span>\r\n            </td>\r\n            <td>{{ formatDate(order.created_at) }}</td>\r\n            <td v-if=\"order.payment_status=='paid'\">{{ formatDate(order.paid_at) }}</td>\r\n            <td v-if=\"order.payment_status=='unpaid'\">Unpaid </td>\r\n            <!-- <td>\r\n              <select v-model=\"order.status\" @change=\"updateOrderStatus(order)\">\r\n                <option value=\"pending\">Pending</option>\r\n                <option value=\"processing\">Processing</option>\r\n                <option value=\"completed\">Completed</option>\r\n                <option value=\"cancelled\">Cancelled</option>\r\n              </select>\r\n            </td> -->\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n\r\n    <!-- Modal for displaying order items -->\r\n    <div v-if=\"showModal\" class=\"modal\">\r\n      <div class=\"modal-content\">\r\n        <h3>Order Items</h3>\r\n        <table>\r\n          <thead>\r\n            <tr>\r\n              <th>Product ID</th>\r\n              <th>Name</th>\r\n              <th>Quantity</th>\r\n              <th>Price</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            <tr v-for=\"item in selectedOrderItems\" :key=\"item.pid\">\r\n              <td>{{ item.pid }}</td>\r\n              <td>{{ item.name }}</td>\r\n              <td>{{ item.quantity }}</td>\r\n              <td>${{ (item.price * item.quantity).toFixed(2) }}</td>\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n        <button @click=\"showModal = false\" class=\"close-btn\">Close</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue'\r\nimport request from '@/utils/request'\r\n\r\nconst orders = ref([])\r\nconst showModal = ref(false)\r\nconst selectedOrderItems = ref([])\r\n\r\nconst fetchOrders = async () => {\r\n  try {\r\n    const response = await request.get('/api/admin/orders', {\r\n      headers: { 'Authorization': `${localStorage.getItem('auth_token')}` }\r\n    })\r\n    orders.value = response.data\r\n  } catch (error) {\r\n    console.error('Failed to fetch orders:', error)\r\n  }\r\n}\r\n\r\nconst showItems = (order) => {\r\n  try {\r\n    // 检查 items 是否已经是对象\r\n    selectedOrderItems.value = typeof order.items === 'string' \r\n      ? JSON.parse(order.items)\r\n      : order.items;\r\n    showModal.value = true;\r\n  } catch (error) {\r\n    console.error('Failed to parse order items:', error);\r\n    alert('Error displaying order items');\r\n  }\r\n}\r\n\r\nconst formatDate = (dateString) => {\r\n  return new Date(dateString).toLocaleString()\r\n}\r\n\r\nconst updateOrderStatus = async (order) => {\r\n  try {\r\n    await request.put(`/api/admin/orders/${order.order_id}`, {\r\n      status: order.status\r\n    }, {\r\n      headers: { 'Authorization': `${localStorage.getItem('auth_token')}` }\r\n    })\r\n  } catch (error) {\r\n    console.error('Failed to update order status:', error)\r\n  }\r\n}\r\n\r\nonMounted(() => {\r\n  fetchOrders()\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.order-admin {\r\n  padding: 20px;\r\n}\r\n\r\ntable {\r\n  width: 100%;\r\n  border-collapse: collapse;\r\n  margin-top: 20px;\r\n}\r\n\r\nth, td {\r\n  padding: 12px;\r\n  text-align: left;\r\n  border-bottom: 1px solid #ddd;\r\n}\r\n\r\nth {\r\n  background-color: #f5f5f5;\r\n}\r\n\r\n.status-badge, .payment-badge {\r\n  padding: 4px 8px;\r\n  border-radius: 4px;\r\n  font-size: 0.9em;\r\n}\r\n\r\n.status-badge.pending { background-color: #fff3cd; color: #856404; }\r\n.status-badge.processing { background-color: #cce5ff; color: #004085; }\r\n.status-badge.completed { background-color: #d4edda; color: #155724; }\r\n.status-badge.cancelled { background-color: #f8d7da; color: #721c24; }\r\n\r\n.payment-badge.paid { background-color: #d4edda; color: #155724; }\r\n.payment-badge.unpaid { background-color: #f8d7da; color: #721c24; }\r\n\r\n.view-items-btn {\r\n  padding: 4px 8px;\r\n  background-color: #007bff;\r\n  color: white;\r\n  border: none;\r\n  border-radius: 4px;\r\n  cursor: pointer;\r\n}\r\n\r\n.modal {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  background-color: rgba(0, 0, 0, 0.5);\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n\r\n.modal-content {\r\n  background-color: white;\r\n  padding: 20px;\r\n  border-radius: 8px;\r\n  min-width: 500px;\r\n}\r\n\r\n.close-btn {\r\n  margin-top: 20px;\r\n  padding: 8px 16px;\r\n  background-color: #6c757d;\r\n  color: white;\r\n  border: none;\r\n  border-radius: 4px;\r\n  cursor: pointer;\r\n}\r\n\r\nselect {\r\n  padding: 4px 8px;\r\n  border-radius: 4px;\r\n  border: 1px solid #ddd;\r\n}\r\n</style>\r\n"],"mappings":"AAoFA,SAASA,GAAG,EAAEC,SAAS,QAAQ,KAAK;AACpC,OAAOC,OAAO,MAAM,iBAAiB;;;;;;;IAErC,MAAMC,MAAM,GAAGH,GAAG,CAAC,EAAE,CAAC;IACtB,MAAMI,SAAS,GAAGJ,GAAG,CAAC,KAAK,CAAC;IAC5B,MAAMK,kBAAkB,GAAGL,GAAG,CAAC,EAAE,CAAC;IAElC,MAAMM,WAAW,GAAG,MAAAA,CAAA,KAAY;MAC9B,IAAI;QACF,MAAMC,QAAQ,GAAG,MAAML,OAAO,CAACM,GAAG,CAAC,mBAAmB,EAAE;UACtDC,OAAO,EAAE;YAAE,eAAe,EAAE,GAAGC,YAAY,CAACC,OAAO,CAAC,YAAY,CAAC;UAAG;QACtE,CAAC,CAAC;QACFR,MAAM,CAACS,KAAK,GAAGL,QAAQ,CAACM,IAAI;MAC9B,CAAC,CAAC,OAAOC,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;MACjD;IACF,CAAC;IAED,MAAME,SAAS,GAAIC,KAAK,IAAK;MAC3B,IAAI;QACF;QACAZ,kBAAkB,CAACO,KAAK,GAAG,OAAOK,KAAK,CAACC,KAAK,KAAK,QAAQ,GACtDC,IAAI,CAACC,KAAK,CAACH,KAAK,CAACC,KAAK,CAAC,GACvBD,KAAK,CAACC,KAAK;QACfd,SAAS,CAACQ,KAAK,GAAG,IAAI;MACxB,CAAC,CAAC,OAAOE,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,8BAA8B,EAAEA,KAAK,CAAC;QACpDO,KAAK,CAAC,8BAA8B,CAAC;MACvC;IACF,CAAC;IAED,MAAMC,UAAU,GAAIC,UAAU,IAAK;MACjC,OAAO,IAAIC,IAAI,CAACD,UAAU,CAAC,CAACE,cAAc,CAAC,CAAC;IAC9C,CAAC;IAED,MAAMC,iBAAiB,GAAG,MAAOT,KAAK,IAAK;MACzC,IAAI;QACF,MAAMf,OAAO,CAACyB,GAAG,CAAC,qBAAqBV,KAAK,CAACW,QAAQ,EAAE,EAAE;UACvDC,MAAM,EAAEZ,KAAK,CAACY;QAChB,CAAC,EAAE;UACDpB,OAAO,EAAE;YAAE,eAAe,EAAE,GAAGC,YAAY,CAACC,OAAO,CAAC,YAAY,CAAC;UAAG;QACtE,CAAC,CAAC;MACJ,CAAC,CAAC,OAAOG,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,gCAAgC,EAAEA,KAAK,CAAC;MACxD;IACF,CAAC;IAEDb,SAAS,CAAC,MAAM;MACdK,WAAW,CAAC,CAAC;IACf,CAAC,CAAC","ignoreList":[]}]}